{% extends 'customers/base.html' %}

{% block content %}
<div class="container">
    <!-- Add Supplier Card -->
    <div class="card mb-4 shadow-lg" style="background-color: var(--glass); color: var(--text);">
        <div class="card-header bg-info text-white">
            <h2 class="mb-0"><i class="fas fa-truck"></i> Add New Supplier</h2>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}

                <!-- Supplier Basic Info -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.name.id_for_label }}" class="form-label" style="color: var(--text);">Supplier Name</label>
                            {{ form.name }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.contact_person.id_for_label }}" class="form-label" style="color: var(--text);">Contact Person</label>
                            {{ form.contact_person }}
                        </div>
                    </div>
                </div>

                <!-- Contact Info -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="{{ form.phone.id_for_label }}" class="form-label" style="color: var(--text);">Phone Number</label>
                            {{ form.phone }}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="{{ form.email.id_for_label }}" class="form-label" style="color: var(--text);">Email Address</label>
                            {{ form.email }}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="{{ form.payment_terms.id_for_label }}" class="form-label" style="color: var(--text);">Payment Terms</label>
                            {{ form.payment_terms }}
                        </div>
                    </div>
                </div>

                <!-- GST & Credit Limit -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.gstin.id_for_label }}" class="form-label" style="color: var(--text);">GSTIN</label>
                            {{ form.gstin }}
                            <small class="form-text text-muted" style="color: var(--text);">Format: 12ABCDE1234F1Z5</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.credit_limit.id_for_label }}" class="form-label" style="color: var(--text);">Credit Limit (â‚¹)</label>
                            {{ form.credit_limit }}
                        </div>
                    </div>
                </div>

                <!-- Supplier Type & Delivery Terms -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.supplier_type.id_for_label }}" class="form-label" style="color: var(--text);">Supplier Type</label>
                            <select class="form-control" id="{{ form.supplier_type.id_for_label }}" name="{{ form.supplier_type.name }}" style="background-color: var(--glass); color: var(--text);">
                                <option value="">Select Supplier Type</option>
                                <option value="manufacturer">Manufacturer</option>
                                <option value="distributor">Distributor</option>
                                <option value="wholesaler">Wholesaler</option>
                                <option value="importer">Importer</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.delivery_terms.id_for_label }}" class="form-label" style="color: var(--text);">Delivery Terms</label>
                            <input type="text" class="form-control" id="{{ form.delivery_terms.id_for_label }}" name="{{ form.delivery_terms.name }}" style="background-color: var(--glass); color: var(--text);">
                        </div>
                    </div>
                </div>

                <!-- Website & Bank Details -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.website.id_for_label }}" class="form-label" style="color: var(--text);">Website</label>
                            <input type="url" class="form-control" id="{{ form.website.id_for_label }}" name="{{ form.website.name }}" placeholder="https://example.com" style="background-color: var(--glass); color: var(--text);">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.bank_details.id_for_label }}" class="form-label" style="color: var(--text);">Bank Details</label>
                            <textarea class="form-control" id="{{ form.bank_details.id_for_label }}" name="{{ form.bank_details.name }}" rows="3" placeholder="Bank Name, Account Number, IFSC Code, etc." style="background-color: var(--glass); color: var(--text);"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Full Address -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="{{ form.address.id_for_label }}" class="form-label" style="color: var(--text);">Full Address</label>
                            <textarea class="form-control" id="{{ form.address.id_for_label }}" name="{{ form.address.name }}" rows="3" placeholder="Enter full address" style="background-color: var(--glass); color: var(--text);"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button type="submit" class="btn btn-info btn-lg">
                        <i class="fas fa-save"></i> Save Supplier
                    </button>
                    <a href="{% url 'customers:manage_inventory' %}" class="btn btn-secondary btn-lg">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- GSTIN Validation -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const gstinField = document.getElementById('{{ form.gstin.id_for_label }}');
    
    gstinField.addEventListener('input', function(e) {
        const gstinRegex = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;
        if (!gstinRegex.test(e.target.value)) {
            e.target.setCustomValidity('Invalid GSTIN format');
        } else {
            e.target.setCustomValidity('');
        }
    });
});
</script>
{% endblock %}